/*!
Name: Open Weather
Dependencies: jQuery, OpenWeatherMap API
Author: Michael Lynch
Author URL: http://michaelynch.com
Date Created: August 28, 2013
Date Modified: February 8, 2016
Modified by: blinksmith
Licensed under the MIT license
*/
(function($) {
  $.fn.openWeather = function(response) {
    if (!this.length) {
      return this;
    }
    $(this);
    this.settings = {};
    var elTarget = this.settings = $.extend({}, {
		iconTarget:null, 
		customIcons:null, 
		city:null, 
		lat:null, 
		lng:null, 
		key:null, 
		lang:"en", 
	success:function() {
    }, error:function($) {
    }}, response);
    response = "//api.openweathermap.org/data/2.5/weather?lang=" + elTarget.lang;
    null != elTarget.city ? response += "&q=" + elTarget.city.replace(" ", "") : null != elTarget.lat && null != elTarget.lng && (response += "&lat=" + elTarget.lat + "&lon=" + elTarget.lng);
    null != elTarget.key && (response += "&appid=" + elTarget.key);
    var formatTime = function($) {
      var response = new Date(1E3 * $);
      $ = response.getHours();
      12 < $ && (hoursRemaining = 24 - $, $ = 12 - hoursRemaining);
      response = response.getMinutes();
      response = response.toString();
      2 > response.length && (response = 0 + response);
      return $ + ":" + response;
    };
    $.ajax({type:"GET", url:response, dataType:"jsonp", success:function(response) {
      $(elTarget.cTarget).text(Math.round(response.main.temp - 273.15) + "\u00b0C");
      $(elTarget.cminTarget).text(Math.round(response.main.temp_min - 273.15) + "\u00b0C");
      $(elTarget.cmaxTarget).text(Math.round(response.main.temp_max - 273.15) + "\u00b0C");
      $(elTarget.fTarget).text(Math.round(1.8 * (response.main.temp - 273.15) + 32) + "\u00b0F");
      $(elTarget.fminTarget).text(Math.round(1.8 * (response.main.temp_min - 273.15) + 32) + "\u00b0F");
      $(elTarget.fmaxTarget).text(Math.round(1.8 * (response.main.temp_min - 273.15) + 32) + "\u00b0F");
      $(elTarget.descriptionTarget).text(response.weather[0].description);
      $(elTarget.lonTarget).text(response.coord.lon);
      $(elTarget.latTarget).text(response.coord.lat);
      $(elTarget.placeTarget).text(response.name + ", " + response.sys.country);
      $(elTarget.windSpeedTarget).text(Math.round(response.wind.speed) + " Mps");
      $(elTarget.humidityTarget).text(response.main.humidity + "%");
      $(elTarget.pressureTarget).text(response.main.pressure + "hPa");
      $(elTarget.sunriseTarget).text(formatTime(response.sys.sunrise) + " AM");
      $(elTarget.sunsetTarget).text(formatTime(response.sys.sunset) + " PM");
      if (null != elTarget.iconTarget && null != response.weather[0].icon) {
        if (null != elTarget.customIcons) {
          response = response.weather[0].icon;
          var iconName, timeOfDay;
          timeOfDay = -1 != response.indexOf("d") ? "day" : "night";
          if ("01d" == response || "01n" == response) {iconName = "clear";}
          if ("02d" == response || "02n" == response || "03d" == response || "03n" == response || "04d" == response || "04n" == response) {iconName = "clouds";}
          if ("09d" == response || "09n" == response || "10d" == response || "10n" == response) {iconName = "rain";}
          if ("11d" == response || "11n" == response) {iconName = "storm";}
          if ("13d" == response || "13n" == response) {iconName = "snow";}
          if ("50d" == response || "50n" == response) {iconName = "mist";}
          iconName = elTarget.customIcons + timeOfDay + "/" + iconName + ".png";
        } else {iconName = "//openweathermap.org/img/timeOfDay/" + response.weather[0].icon + ".png";}
        $(elTarget.iconTarget).attr("src", iconName);
      }
      elTarget.success.call(this);
    }, error:function($, response, formatTime) {
      elTarget.error.call(this, response);
    }});
  };
})(jQuery);
